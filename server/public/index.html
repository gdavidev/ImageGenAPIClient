<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>AI Background Generator</title>
  <!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
  <style>
      section {
          margin-bottom: 2rem;
      }

      .slot {
          height: calc(1rem + 2rem);
      }

      .prompt-piece-container {
          display: flex;
          flex-wrap: wrap;
          gap: 1rem;
      }

      .prompt-piece {
          padding: 1rem;
          color: white;
          font-weight: bold;
          border-radius: 0.5rem;
          cursor: pointer;
          transition: top 1s ease, left 1s ease;
          width: fit-content;
          position: absolute;
      }

      .prompt-piece p {
          padding: 0;
          margin: 0;
      }
  </style>
</head>
<body>
<div class="container mt-5">
  <h1 class="text-center mb-4">AI Background Generator</h1>
  <p class="text-center">Choose options below to compose your custom background prompt!</p>
  
  <section>
    <h2>Escolha o local</h2>
    
    <div id="scene" class="prompt-piece-container">
      <div data-id="1" class="slot"></div>
      <div data-id="2" class="slot"></div>
      <div data-id="3" class="slot"></div>
      <div data-id="4" class="slot"></div>
      <div data-id="5" class="slot"></div>
      <div data-id="6" class="slot"></div>
      <div data-id="7" class="slot"></div>
      <div data-id="8" class="slot"></div>
    </div>
  </section>
  
  <section>
    <h2>Detalhes da cena</h2>
    
    <div id="detail" class="prompt-piece-container">
      <div data-id="9" class="slot"></div>
      <div data-id="10" class="slot"></div>
      <div data-id="11" class="slot"></div>
      <div data-id="12" class="slot"></div>
      <div data-id="13" class="slot"></div>
      <div data-id="14" class="slot"></div>
      <div data-id="15" class="slot"></div>
      <div data-id="16" class="slot"></div>
    </div>
  </section>
  
  <section>
    <h2>Clima da cena</h2>
    
    <div id="mood" class="prompt-piece-container">
      <div data-id="17" class="slot"></div>
      <div data-id="18" class="slot"></div>
      <div data-id="19" class="slot"></div>
      <div data-id="20" class="slot"></div>
      <div data-id="21" class="slot"></div>
      <div data-id="22" class="slot"></div>
      <div data-id="23" class="slot"></div>
      <div data-id="24" class="slot"></div>
    </div>
  </section>
  
  <section>
    <h2>Sua imagem:</h2>
    <div id="prompt-slots" class="prompt-piece-container">
    </div>
  </section>
  
  <!-- Submit Button -->
  <div class="text-center mt-5">
    <button id="generate-image" class="btn btn-lg btn-primary">Gerar Imagem</button>
  </div>
  
  <div id="pieces">
    <!-- Cenários -->
    <div data-slot-id="1" data-prompt-slot-id="0" data-category="scene" class="prompt-piece">
      <p class="user-select-none text-nowrap">Praia com coqueiros</p>
    </div>
    <div data-slot-id="2" data-prompt-slot-id="0" data-category="scene" class="prompt-piece">
      <p class="user-select-none text-nowrap">Floresta densa com raios de sol entrando</p>
    </div>
    <div data-slot-id="3" data-prompt-slot-id="0" data-category="scene" class="prompt-piece">
      <p class="user-select-none text-nowrap">Horizonte de cidade moderna ao pôr do sol</p>
    </div>
    <div data-slot-id="4" data-prompt-slot-id="0" data-category="scene" class="prompt-piece">
      <p class="user-select-none text-nowrap">Montanhas cobertas de neve</p>
    </div>
    <div data-slot-id="5" data-prompt-slot-id="0" data-category="scene" class="prompt-piece">
      <p class="user-select-none text-nowrap">Castelo encantado nas nuvens</p>
    </div>
    <div data-slot-id="6" data-prompt-slot-id="0" data-category="scene" class="prompt-piece">
      <p class="user-select-none text-nowrap">Deserto com dunas de areia e sol brilhante</p>
    </div>
    <div data-slot-id="7" data-prompt-slot-id="0" data-category="scene" class="prompt-piece">
      <p class="user-select-none text-nowrap">Recife de corais subaquático</p>
    </div>
    <div data-slot-id="8" data-prompt-slot-id="0" data-category="scene" class="prompt-piece">
      <p class="user-select-none text-nowrap">Ruínas antigas em uma floresta tropical</p>
    </div>
    
    <!-- Clima -->
    <div data-slot-id="9" data-prompt-slot-id="0" data-category="mood" class="prompt-piece">
      <p class="user-select-none text-nowrap">Claro e ensolarado</p>
    </div>
    <div data-slot-id="10" data-prompt-slot-id="0" data-category="mood" class="prompt-piece">
      <p class="user-select-none text-nowrap">Nebuloso e mágico</p>
    </div>
    <div data-slot-id="11" data-prompt-slot-id="0" data-category="mood" class="prompt-piece">
      <p class="user-select-none text-nowrap">Noite estrelada com estrelas brilhantes</p>
    </div>
    <div data-slot-id="12" data-prompt-slot-id="0" data-category="mood" class="prompt-piece">
      <p class="user-select-none text-nowrap">Hora dourada com tons quentes</p>
    </div>
    <div data-slot-id="13" data-prompt-slot-id="0" data-category="mood" class="prompt-piece">
      <p class="user-select-none text-nowrap">Chuvoso e dramático com relâmpagos</p>
    </div>
    <div data-slot-id="14" data-prompt-slot-id="0" data-category="mood" class="prompt-piece">
      <p class="user-select-none text-nowrap">Nebuloso e misterioso</p>
    </div>
    <div data-slot-id="15" data-prompt-slot-id="0" data-category="mood" class="prompt-piece">
      <p class="user-select-none text-nowrap">Crepúsculo calmo com céu rosado</p>
    </div>
    <div data-slot-id="16" data-prompt-slot-id="0" data-category="mood" class="prompt-piece">
      <p class="user-select-none text-nowrap">Céu tempestuoso com nuvens escuras</p>
    </div>
    
    <!-- Detalhes -->
    <div data-slot-id="17" data-prompt-slot-id="0" data-category="detail" class="prompt-piece">
      <p class="user-select-none text-nowrap">Pássaros voando ao fundo</p>
    </div>
    <div data-slot-id="18" data-prompt-slot-id="0" data-category="detail" class="prompt-piece">
      <p class="user-select-none text-nowrap">Flores vibrantes</p>
    </div>
    <div data-slot-id="19" data-prompt-slot-id="0" data-category="detail" class="prompt-piece">
      <p class="user-select-none text-nowrap">Arco-íris no céu</p>
    </div>
    <div data-slot-id="20" data-prompt-slot-id="0" data-category="detail" class="prompt-piece">
      <p class="user-select-none text-nowrap">Balões de ar quente flutuando</p>
    </div>
    <div data-slot-id="21" data-prompt-slot-id="0" data-category="detail" class="prompt-piece">
      <p class="user-select-none text-nowrap">Reflexo em um lago calmo</p>
    </div>
    <div data-slot-id="22" data-prompt-slot-id="0" data-category="detail" class="prompt-piece">
      <p class="user-select-none text-nowrap">Estrelas cadentes ao fundo</p>
    </div>
    <div data-slot-id="23" data-prompt-slot-id="0" data-category="detail" class="prompt-piece">
      <p class="user-select-none text-nowrap">Vagalumes brilhando no ar</p>
    </div>
    <div data-slot-id="24" data-prompt-slot-id="0" data-category="detail" class="prompt-piece">
      <p class="user-select-none text-nowrap">Lanternas flutuando no céu</p>
    </div>
  
  </div>
</div>

<!-- Bootstrap JS -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
        crossorigin="anonymous"></script>
<script>
  const pieces = Array.from(document.getElementsByClassName("prompt-piece"));
  const slots = Array.from(document.getElementsByClassName("slot"));
  const promptSlotsContainer = document.getElementById("prompt-slots");
  const piecesColorList = ['dodgerblue', 'green', 'crimson', 'orange', 'purple'];
  
  pieces.map(piece => {
    piece.style.backgroundColor = piecesColorList[Math.floor(Math.random() * piecesColorList.length)];
    
    piece.addEventListener("click", () => {
      const promptSlots = Array.from(promptSlotsContainer.getElementsByClassName('slot'));
      const currentPromptSlotId = piece.getAttribute('data-prompt-slot-id')
      
      if (currentPromptSlotId !== "0") {
        promptSlotsContainer.removeChild(document.querySelector(`#prompt-slots div[data-id="${currentPromptSlotId}"]`));
        piece.setAttribute('data-prompt-slot-id', "0")
      } else {
        let newSlotId = 1;
        if (promptSlots.length > 0) {
          const promptSlotsIds = promptSlots.map(slot => Number(slot.getAttribute('data-id')));
          newSlotId = Math.max(...promptSlotsIds) + 1;
        }
        
        const newSlot = document.createElement('div')
        newSlot.setAttribute('data-id', String(newSlotId));
        newSlot.classList.add('slot');
        promptSlotsContainer.appendChild(newSlot);
        
        piece.setAttribute('data-prompt-slot-id', String(newSlotId))
      }
      
      updatePiecesPosition()
    });
  });
  
  function updatePiecesPosition() {
    const promptSlots = Array.from(promptSlotsContainer.getElementsByClassName('slot'));
    
    pieces.map(piece => {
      const slotId = piece.getAttribute("data-slot-id");
      const promptSlotId = piece.getAttribute("data-prompt-slot-id");
      
      const originalSlot = slots.find(slot => slot.getAttribute('data-id') === slotId)
      if (promptSlotId === "0") {
        originalSlot.style.marginLeft = '0px'; // Compensate to flex gap
        matchSlotAndPiece(originalSlot, piece);
      } else {
        originalSlot.style.width = '0px';
        originalSlot.style.marginLeft = '-1rem'; // Compensate to flex gap
        const target = promptSlots.find(slot => slot.getAttribute('data-id') === promptSlotId)
        matchSlotAndPiece(target, piece)
      }
    });
  }
  
  function matchSlotAndPiece(slot, piece) {
    const rect = slot.getBoundingClientRect();
    
    slot.style.width = piece.offsetWidth + 'px';
    piece.style.top = rect.top + 'px';
    piece.style.left = rect.left + 'px';
  }
  
  updatePiecesPosition()
  window.onresize = updatePiecesPosition;
  
  document.getElementById('generate-image').addEventListener('click', function (e) {
    const pieces = Array.from(document.getElementById('pieces').getElementsByClassName('prompt-piece'));
    const selectedPieces = pieces.filter(piece => piece.getAttribute('data-prompt-slot-id') !== "0");
    
    const scenePieces = selectedPieces.filter(piece => piece.getAttribute('data-category') === "scene");
    const detailsPieces = selectedPieces.filter(piece => piece.getAttribute('data-category') === "detail");
    const moodPieces = selectedPieces.filter(piece => piece.getAttribute('data-category') === "mood");
    
    let prompt = 'Generate an background image with the following attributes:'
    if (scenePieces && scenePieces.length > 0) {
      const scene = scenePieces.map(piece => piece.getElementsByTagName('p')[0].innerHTML)
      prompt += ` Scene: ${ scene.join(', ') }`
    }
    if (detailsPieces && detailsPieces.length > 0) {
      const details = detailsPieces.map(piece => piece.getElementsByTagName('p')[0].innerHTML)
      prompt += ` Details: ${ details.join(', ') }`
    }
    if (moodPieces && moodPieces.length > 0) {
      const mood = moodPieces.map(piece => piece.getElementsByTagName('p')[0].innerHTML)
      prompt += ` Mood: ${ mood.join(', ') }`
    }
    
    fetch('/api/generate-image', {
      method: 'POST',
      headers: {
        "Content-Type": "application/json",
      },
      body: JSON.stringify({
        prompt: prompt,
      })
    })
  });
</script>
</body>
</html>